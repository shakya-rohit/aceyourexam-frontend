<div class="dashboard-container">
  <h2>Welcome, {{ user?.name || 'Student' }} ðŸ‘‹</h2>

  <!-- ---------- SUMMARY CARDS ---------- -->
  <div class="stats-section">
    <mat-card class="stat-card">
      <h3>{{ totalExams }}</h3>
      <p>Total Exams Taken</p>
    </mat-card>
    <mat-card class="stat-card">
      <h3>{{ averageScore }}</h3>
      <p>Average Score</p>
    </mat-card>
    <mat-card class="stat-card">
      <h3>{{ bestScore }}</h3>
      <p>Best Score</p>
    </mat-card>
  </div>

  <!-- ---------- PERFORMANCE CHART ---------- -->
  <div class="chart-section" *ngIf="results.length">
    <h3 class="chart-title">Performance Over Time</h3>
    <!-- ---------- SUBJECT TOGGLES ---------- -->
    <div class="subject-toggle">
      <label *ngFor="let s of subjectFilters">
        <input
          type="checkbox"
          [checked]="s.visible"
          (change)="toggleDataset(s.label, $event)"
        />
        <span>{{ s.label }}</span>
      </label>
    </div>

    <div class="chart-wrapper">
      <canvas
        baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="'line'">
      </canvas>
    </div>
  </div>

  <!-- ---------- RECOMMENDATIONS ---------- -->
  <div class="recommendations" *ngIf="recommendations.length">
    <h3>Recommendations for You</h3>
    <ul>
      <li *ngFor="let rec of recommendations">{{ rec }}</li>
    </ul>
  </div>

  <mat-divider style="margin: 2rem 0;"></mat-divider>

  <!-- ---------- EXAMS ---------- -->
  <!-- <h3>Available Exams</h3>
  <div class="exam-list">
    <mat-card *ngFor="let exam of exams" class="exam-card">
      <h3>{{ exam.title }}</h3>
      <p>Duration: {{ exam.durationMinutes }} mins</p>
      <p>Total Marks: {{ exam.totalMarks }}</p>
      <button mat-raised-button color="primary" (click)="startExam(exam)">Start Exam</button>
    </mat-card>
  </div> -->

  <!-- ---------- EXAMS WITH TABS ---------- -->
<h3>Exams:</h3>

<mat-tab-group
  [(selectedIndex)]="selectedExamTab"
  class="exam-tabs"
  animationDuration="300ms">

  <!-- UPCOMING (DEFAULT) -->
  <mat-tab label="Upcoming">
    <div class="exam-list">
      <mat-card *ngFor="let exam of upcomingExams" class="exam-card">
        <h3>{{ exam.title }}</h3>
        <p>Duration: {{ exam.durationMinutes }} mins</p>
        <p>Total Marks: {{ exam.totalMarks }}</p>
        <button
          mat-raised-button
          color="primary"
          (click)="startExam(exam)">
          Start Exam
        </button>
      </mat-card>

      <p *ngIf="!upcomingExams.length" class="empty-text">
        No upcoming exams available.
      </p>
    </div>
  </mat-tab>

  <!-- ALL -->
  <mat-tab label="All">
    <div class="exam-list">
      <mat-card *ngFor="let exam of exams" class="exam-card">
        <h3>{{ exam.title }}</h3>
        <p>Duration: {{ exam.durationMinutes }} mins</p>
        <p>Total Marks: {{ exam.totalMarks }}</p>
        <button
          mat-raised-button
          color="primary"
          (click)="startExam(exam)">
          Start Exam
        </button>
      </mat-card>
    </div>
  </mat-tab>

  <!-- PAST -->
  <mat-tab label="Past">
    <div class="exam-list">
      <mat-card *ngFor="let exam of pastExams" class="exam-card past-exam">
        <h3>{{ exam.title }}</h3>
        <p>Completed</p>
      </mat-card>

      <p *ngIf="!pastExams.length" class="empty-text">
        You havenâ€™t attempted any exams yet.
      </p>
    </div>
  </mat-tab>

</mat-tab-group>


  <mat-divider style="margin: 2rem 0;"></mat-divider>

  <!-- ---------- RESULTS ---------- -->
  <div class="results-section">
    <h3>Your Past Results:</h3>

    <ng-container *ngIf="results.length; else noResults">
      <div *ngFor="let r of results" class="result-card">
        <mat-card>
          <strong>{{ r.examTitle }}</strong>
          <div class="result-score">{{ r.totalScore }} / 720</div>
          <div class="result-date">Submitted: {{ r.submittedAt }}</div>
        </mat-card>
      </div>
    </ng-container>

    <ng-template #noResults>
      <p>No past results yet. Take a test to see them here!</p>
    </ng-template>
  </div>
</div>
