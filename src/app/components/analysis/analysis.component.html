<div class="analysis-container">
  <h2>{{ attemptData?.examTitle }}</h2>
  <p><b>Date:</b> {{ attemptData?.submittedAt | date:'medium' }}</p>
  <p><b>Score:</b> {{ attemptData?.totalScore }} / 720</p>

  <div class="charts-section">
    <div class="chart-card">
      <h3>Overall Accuracy</h3>
      <canvas baseChart [data]="pieChartData" [type]="'doughnut'"></canvas>
    </div>

    <div class="chart-card">
      <h3>Subject-wise Performance</h3>
      <canvas baseChart [data]="barChartData" [type]="'bar'"></canvas>
    </div>
  </div>

  <div class="questions-section">
    <h3>Question Analysis</h3>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Question</th>
          <th>Your Answer</th>
          <th>Correct Answer</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let q of attemptData?.questions; index as i">
          <td>{{ i + 1 }}</td>
          <td>{{ q.questionText }}</td>
          <td>{{ q.selectedOptionIndex || '-' }}</td>
          <td>{{ q.correctOptionIndex }}</td>
          <td [class.correct]="q.isCorrect" [class.incorrect]="!q.isCorrect">
            {{ q.isCorrect ? '✔️' : '❌' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <button mat-raised-button color="primary" (click)="backToResults()">Back to Results</button>
</div>
